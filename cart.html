<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Applied Robotics - Heart Monitors</title>
        <link rel="icon" type="image/x-icon" href="/img/icon1.png">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
        <link rel="stylesheet" href="style.css">
        <script src="https://js.stripe.com/v3/"></script>
    </head>

    <body>
        <section id="header">
            <a href="#"><img src="img/winrx_logo.png" class="logo" alt=""></a>

            <div>
                <ul id="navbar">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="shop.html">Shop</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li id="lg-bag"><a class="active" href="cart.html"><i class='bx bx-shopping-bag' ></i></a></li>
                    <a href="#" id="close"><i class='bx bx-x'></i></a>
                </ul>
            </div>
            <div id="mobile">
                <a href="cart.html"><i class='bx bx-shopping-bag' ></i></a>
                <i id="bar" class='bx bx-menu'></i>
            </div>
        </section>

        <section id="page-header" class="about-header">
            <h2>#shopping_cart</h2>
            <p>Your healthcare technology cart</p>
        </section>

        <section id="cart" class="section-p1">
            <table width="100%" id="cart-table">
                <thead>
                    <tr>
                        <td>Remove</td>
                        <td>Image</td>
                        <td>Product</td>
                        <td>Price</td>
                        <td>Quantity</td>
                        <td>Subtotal</td>
                    </tr>
                </thead>
                <tbody>
                    <!-- Cart items will be dynamically loaded here -->
                </tbody>
            </table>
            <p id="cart-message" style="text-align: center; margin-top: 20px;">Your cart is empty.</p>
        </section>

        <section id="cart-add" class="section-p1">
            <div id="coupon">
                <h3>Apply Coupon</h3>
                <div>
                    <input type="text" placeholder="Enter Your Coupon">
                    <button class="normal">Apply</button>
                </div>
            </div>

            <div id="subtotal">
                <h3>Cart Total</h3>
                <table>
                    <tr>
                        <td>Cart Subtotal</td>
                        <td id="cart-subtotal">$0.00</td>
                    </tr>
                    <tr>
                        <td>Shipping</td>
                        <td>Free</td>
                    </tr>
                    <tr>
                        <td><strong>Total</strong></td>
                        <td><strong id="cart-total">$0.00</strong></td>
                    </tr>
                </table>
                <button class="normal" onclick="proceedToCheckout()">Proceed to checkout</button>
            </div>
        </section>

        <footer class="section-p1">
            <div class="col">
                <img class="logo" src="./img/winrx_logo.png" alt="">
                <h4>Contact</h4>
                <p><strong>Address:</strong> Box 205 Stn. Fort Langley, Langley, BC, V1M 2R5</p>
                <p><strong>Phone:</strong> (778) 949 - 6264</p>
                <p><strong>Hours:</strong> 9:00 - 17:00, Mon - Fri PST</p>
                <div class="follow">
                    <h4>Follow us</h4>
                    <div class="icon">
                        <i class='bx bxl-facebook'></i>
                        <i class='bx bxl-twitter' ></i>
                        <i class='bx bxl-instagram' ></i>
                        <i class='bx bxl-pinterest-alt' ></i>
                        <i class='bx bxl-youtube' ></i>
                    </div>
                </div>
            </div>

            <div class="col">
                <h4>About</h4>
                <a href="#">About us</a>
                <a href="#">Devlivery Information</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Terms & Conditions</a>
                <a href="#">Contact Us</a>
            </div>

            <div class="col">
                <h4>My Account</h4>
                <a href="#">Sign In</a>
                <a href="#">View Cart</a>
                <a href="#">My Wishlist</a>
                <a href="#">Track My Order</a>
                <a href="#">Help</a>
            </div>

            <div class="col install">
                <h4>Install App</h4>
                <p>From App Store or Google Play</p>
                <div class="row">
                    <img src="./img/pay/app.jpg" alt="">
                    <img src="./img/pay/play.jpg" alt="">
                </div>
                <p>Secured Payment Gateways</p>
                <img src="./img/pay/pay.png" alt="">
            </div>

                         <div class="copyright">
                 <p>Â© 2024, Applied Robotics - Healthcare Technology Solutions</p>
             </div>
        </footer>

        <script>
            // Load cart item from localStorage
            document.addEventListener('DOMContentLoaded', function() {
                const cartItem = JSON.parse(localStorage.getItem('cartItem'));
                const cartTable = document.getElementById('cart-table');
                const cartMessage = document.getElementById('cart-message');

                if (cartItem) {
                    // Show cart table and populate it
                    cartTable.style.display = 'table';
                    cartMessage.style.display = 'none';

                    // Add item to table
                    const tbody = cartTable.querySelector('tbody');
                    const subtotal = (cartItem.price * cartItem.quantity) / 100; // Convert from cents

                    tbody.innerHTML = `
                        <tr>
                            <td><a href="#" onclick="removeFromCart()"><i class='bx bx-x-circle'></i></a></td>
                            <td><img src="${cartItem.image}" alt="${cartItem.name}"></td>
                            <td>${cartItem.name}<br><small>Size: ${cartItem.size}, Color: ${cartItem.color}</small></td>
                            <td>$${(cartItem.price / 100).toFixed(2)}</td>
                            <td><input type="number" value="${cartItem.quantity}" min="1" onchange="updateQuantity(this.value)"></td>
                            <td>$${subtotal.toFixed(2)}</td>
                        </tr>
                    `;

                    // Update subtotal
                    document.querySelector('#subtotal table tbody').innerHTML = `
                        <tr>
                            <td>Cart Subtotal</td>
                            <td>$${subtotal.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td>Shipping</td>
                            <td>Free</td>
                        </tr>
                        <tr>
                            <td><strong>Total</strong></td>
                            <td><strong>$${subtotal.toFixed(2)}</strong></td>
                        </tr>
                    `;
                } else {
                    // Show empty cart message
                    cartTable.style.display = 'none';
                    cartMessage.style.display = 'block';
                }
            });

            function removeFromCart() {
                localStorage.removeItem('cartItem');
                location.reload();
            }

            function updateQuantity(newQuantity) {
                const cartItem = JSON.parse(localStorage.getItem('cartItem'));
                if (cartItem) {
                    cartItem.quantity = parseInt(newQuantity);
                    localStorage.setItem('cartItem', JSON.stringify(cartItem));
                    location.reload();
                }
            }

            async function proceedToCheckout() {
                const cartItem = JSON.parse(localStorage.getItem('cartItem'));
                if (!cartItem) {
                    alert('Your cart is empty');
                    return;
                }

                try {
                    const response = await fetch('/create-checkout-session', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            items: [cartItem]
                        }),
                    });

                    const session = await response.json();

                    // Redirect to Stripe Checkout
                    const stripe = Stripe('pk_test_51RrQMWAicdvqG4FAYvN8HxwJpAGaLvEayXo1V8fTFRnJPHd5J4Y4Q8KfJOqZOkHfJH1JGfJKHgRaGTrRKY7zJo7F00lHrHKT7z'); // Replace with your publishable key
                    const { error } = await stripe.redirectToCheckout({
                        sessionId: session.id
                    });

                    if (error) {
                        console.error('Error:', error);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Something went wrong. Please try again.');
                }
            }
        </script>
        <script src="https://js.stripe.com/v3/"></script>
        <script src="script.js"></script>
    </body>
</html>